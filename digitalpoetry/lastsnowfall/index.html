<html>

<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">

    <title>The Last Snowfall</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.5.1/snap.svg-min.js" integrity="sha512-Gk+uNk8NWN235mIkS6B7/424TsDuPDaoAsUekJCKTWLKP6wlaPv+PBGfO7dbvZeibVPGW+mYidz0vL0XaWwz4w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


</head>
<body>
  <div id='svg'>
  </div>
  <script type="application/javascript">
    function getRandomInt(min,max) {
      return Math.floor(Math.random() * (max-min)) + min;
    }
    const lines = [
      "language falls atop the bones of old words",
      "language falls atop the bones of my old words",
      "your language falls atop the bones of old",
      "your language falls atop the bones of elders",
      "your language falls atop our bones and elders",
      "our language falls and topples bones and elders",
      "our language falls and topples bows and angles",
      "our language falls and topples over and angers",
      "our language falls and top-heavy flips over",
      "our language falls and topographically anchors",
      "language falls and makes topography",
      "language falling and making topography",
      "my language falls close to hungarian topography",
      "my language falls close to english topography",
      "my language falls close to australian topography",
      "my language falls close to american topography",
      "my language falls close to colonialism",
      "my language falls close to occupation",
      "my language falls close to your language",
      "language falls close to your language",
      "language falls close to you and me and you",
      "land gauges fall close to you and me and you",
      "land falls atop the bones of old words",
      "plankton falls atop the bones of old worlds"

    ];
    const yheight = 300;
    const ydrop = 200;
    const ystart = 50;
    const droptime = 6000;
    const lineheight = 6;
    var s = Snap(800, yheight);
    // var s = Snap("#svg");
    console.log('s', s);

    var lines_obj = {};
    var i = 0;
    var c = 0;
    var t1;
    var xwidth;

    function getFrames() {
      xwidth = getRandomInt(20,400);
      var frames = [
        { animation: {'fill-opacity': .8}, dur: droptime/3},
        { animation: {y: (ydrop/2) + ystart}, dur: droptime/2 },
        { animation: {y: ydrop + ystart}, dur: droptime/2 },
        { animation: {y: ydrop + ystart + getRandomInt(10,20)}, dur: droptime*5 }
      ];
      return frames;
    }

    function nextFrame (element, frames, idx) {
      if (idx >= frames.length) { return; }
      if (idx == 2) { dropLine(); }
      element.animate(frames[idx].animation, frames[idx].dur, nextFrame.bind(null, element, frames, idx+1));
    }

    dropLine();

    function dropLine() {
      fr = getFrames();
      lines_obj[c] = s.text(xwidth, ystart, lines[i]);
      lines_obj[c].attr({'fill-opacity': 0});
      nextFrame(lines_obj[c], fr, 0);
      c++; i++; if (i >= lines.length) { i = 0; }
    }

    function fadeOut(text) {
      
    }
  </script>
</body>