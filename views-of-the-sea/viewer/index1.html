<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letter Currents</title>
    <style>
        body {
            margin: 0;
            padding: 40px;
            font-family: 'Courier New', monospace;
            background: #f5f5f0;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
        }
        
        .poems {
            display: flex;
            gap: 100px;
            position: relative;
            z-index: 2;
        }
        
        .poem {
            flex: 1;
            font-size: 16px;
            line-height: 1.8;
            white-space: pre-wrap;
            font-family: 'Georgia', serif;
        }

        .letter {
            opacity: .5;
        }

        .special-letter {
            opacity: 1;
        }

        .punctuation {
            opacity: .5;
        }
        
        .poem span {
            position: relative;
        }
        
        svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        path {
            fill: none;
            stroke-width: 0.5;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <svg id="connections"></svg>
        <div class="poems">
            <div class="poem" id="poem1"></div>
            <div class="poem" id="poem2"></div>
        </div>
    </div>

    <script>
        const poem1Text = `here a view of the sea:
achy blue, w/ fresh mist knit
 
into your hair like wool. the surfers snip lithe lines,
taut watercolor cheer. she eyes the pleasantries.
 
i have been deeply depressed
but start to see her as she is:
 
segmented & all one, at peace
w/ her ever changing roar.
 
did you ever think you could let your grief
pass by? did anyone tell you how?
 
no one told me. many years i stood by the sea,
hollow, slow in her toil, me in my own shit,
 
torn on contradictions in the heart.
wet & broke, the sea crowns, winks.
 
i thirst for theories to own, retool, tether, whet.
i feel unseen, but yoke eye to eye, keen low.
 
then,
         a hush.`;

        const poem2Text = `here she is.
i returned to her.
my eyes water, i miss
another sea. i see her, another consort,
seeking a different divinity. the tears don't
cooperate, unhook eye from hue. at midday,
the sun tires. i kiss the sea w/ tears,
all one sea, yes? i toss her
out, want a different lover, a keeper, i tire, chore, all
this newness, i want a steady gait,
the tide returning, water howling, who will
help me here, wry, honor hewn & hollow &
alone on the brink of sea & sea.
eyes cloy & dupe, see, see?
weekly vow to lose blood, concoct w/
chlorophyl & bryophyte, herd honesty & still
i unbutton my butte, touch the skyline, oh
to be in love & be unsure.`;

        // Function to wrap each character in a span with sequential index
        function wrapCharacters(text, poemNum) {
            let letterIdx = 0;
            return text.split('').map((char) => {
                if (char.match(/[a-zA-Z]/)) {
                    const letterClass = char.toLowerCase() === 's' ? 'special-letter' : 'letter';
                    const result = `<span class="${letterClass}" data-letter-idx="${letterIdx}" data-poem="${poemNum}">${char}</span>`;
                    letterIdx++;
                    return result;
                } else if (char.match(/[^\s]/)) { // punctuation and other non-space characters
                    return `<span class="punctuation" data-poem="${poemNum}">${char}</span>`;
                }
                return char; // spaces and other whitespace remain unwrapped
            }).join('');
        }

        // Render poems
        document.getElementById('poem1').innerHTML = wrapCharacters(poem1Text, 1);
        document.getElementById('poem2').innerHTML = wrapCharacters(poem2Text, 2);

        // Get letter positions by letter index
        function getLetterPositions(poemNum) {
            const letters = document.querySelectorAll(`[data-poem="${poemNum}"]`);
            const positions = [];
            
            letters.forEach(letter => {
                const rect = letter.getBoundingClientRect();
                const container = document.querySelector('.container').getBoundingClientRect();
                const idx = parseInt(letter.getAttribute('data-letter-idx'));
                
                positions[idx] = {
                    x: rect.left + rect.width / 2 - container.left,
                    y: rect.top + rect.height / 2 - container.top,
                    char: letter.textContent.toLowerCase(),
                    mapped: false
                };
            });
            
            return positions;
        }

        function generateLetterLines() {
            const positions1 = getLetterPositions(1);
            const positions2 = getLetterPositions(2);
            const svg = document.getElementById('connections');
            console.log(positions1.length, positions2.length);
            
            // Connect each letter by index
            const maxLength = positions1.length;
            
            for (let i = 0; i < maxLength; i++) {
                let char_i = positions1[i].char;
                if (char_i !== "s") { continue; }
                for (let j = 0; j < maxLength; j++) {
                    let char_j = positions2[j].char;
                    if (char_j !== "s") { continue; }
                    if (char_i === char_j & positions2[j].mapped === false) {
                        positions2[j].mapped = true;
                        const { x: x1, y: y1 } = positions1[i];
                        const { x: x2, y: y2 } = positions2[j];
                        
                        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        path.setAttribute('d', `M ${x1} ${y1} L ${x2} ${y2}`);
                        path.setAttribute('stroke', "black");
                        
                        svg.appendChild(path);
                        break;
                    }
                }
            }
        }

        // Draw connections - each letter in poem1 connects to the letter at the same index in poem2
        document.addEventListener('DOMContentLoaded', async function() {
            generateLetterLines();
        });
    </script>
</body>
</html>